@startuml water_state
hide empty description

state waiting {
  waiting: feed\t\toff
  waiting: purge\ton
  waiting: pump\toff
  waiting: btn\t\tpause
  waiting: /wait idle_time
}

state warming {
  warming : feed\t\ton
  warming : purge\ton
  warming : pump\toff
  warming : /wait warming_time
}

state pumping {
  state rinsing {
    rinsing: feed\t\ton
    rinsing: purge\ton
    rinsing: pump\ton
    rinsing: /wait rinse_time
  }

  state running {
    running: feed\t\ton
    running: purge\toff
    running: pump\ton
    running: btn\t\tplay
    running: /wait cycle_time
  }
  state stopstart <<choice>>
}

[*] --> waiting : start
waiting --> warming : rinse_needed
waiting --> warming : btn_pressed\n[btn = play]
warming --> rinsing: primed
rinsing --> stopstart: rinsed
stopstart --> running : [btn == play]
running --> rinsing: btn_pressed\n[btn = pause]
stopstart--> waiting : [btn == pause]
running --> rinsing: cycle
pumping --> waiting : pump_time

@enduml